<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Products</title>
    <meta http-equiv="Cache-Control" content="no-store" />
    <link rel="stylesheet" href="css/products.css" />
</head>
<body>
<div class="container">
    <h1>Product Dashboard</h1>

    <div id="authed" style="display:none;">
        <p id="whoami"></p>
        <a id="logout" href="/.auth/logout?post_logout_redirect_uri=/index.html">Logout</a>
    </div>

    <div id="gate" style="display:none;">Checking sign-inâ€¦</div>
</div>

<script>
    <script>
    (async () => {
      try {
        const res = await fetch('/.auth/me', { credentials: 'include', cache: 'no-store' });
        const data = res.ok ? await res.json() : [];
        const claims = data?.[0]?.user_claims ?? [];
        const name = (claims.find(c => c.typ.endsWith('/name'))||{}).val
                  || (claims.find(c => c.typ.endsWith('/emailaddress'))||{}).val
                  || data?.[0]?.user_id || 'User';
        document.getElementById('whoami').textContent = `Signed in as ${name}`;
        document.getElementById('authed').style.display = 'block';
      } catch {}
    })();
</script>

</script>
</body>
</html>
